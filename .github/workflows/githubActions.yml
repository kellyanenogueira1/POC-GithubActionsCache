# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the main and develop branches
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    name: Test
    env:
      SCHEME: "POC-GithubActionsCache"
      DEVICE: "iPhone 11"
      DERIVED_DATA_PATH: "DerivedData"

    runs-on: macos-latest
    strategy:
      matrix:
        destination: ['platform=iOS Simulator,OS=14.2,name=iPhone 11']
        xcode: ['/Applications/Xcode_12.2.app/Contents/Developer']

    #defaults:
      #run:
        #working-directory: ./POC-GithubActionsCache

    steps:

      - name: Checkout
        uses: actions/checkout@v2

      - name: Cache
        uses: actions/cache@v2.1.6
        id: carthage-cache
        with:
          path: Carthage
          key: ${{ runner.os }}-carthage-${{ hashFiles('**/Cartfile.resolved') }}

      - name: Build Dependencies
        if: steps.carthage-cache.outputs.cache-hit != 'true'
        run: |
          curl https://gist.githubusercontent.com/skymobilebuilds/61f4a95bd62a3db36b52719aeab7e0d5/raw/61affe5b13efaeb83ba3aaf5ef2cb97bab893485/carthage-xc12.sh -o wcarthage && chmod +x wcarthage
          ./wcarthage bootstrap --platform iOS --cache-builds
